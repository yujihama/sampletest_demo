# フロントエンドアーキテクチャ概要

このドキュメントは、`frontend` ディレクトリに配置されているフロントエンドアプリケーションの構成、フォルダ構造、および各ファイルの役割について説明します。

## 1. 技術スタック

このプロジェクトは、以下の主要な技術を使用して構築されています。

- **フレームワーク/ライブラリ:** [React](https://react.dev/) (v19)
- **ビルドツール:** [Vite](https://vitejs.dev/)
- **UIコンポーネント:** [shadcn/ui](https://ui.shadcn.com/)
  - [Radix UI](https://www.radix-ui.com/) (プリミティブ)
  - [Lucide React](https://lucide.dev/guide/packages/lucide-react) (アイコン)
- **スタイリング:** [Tailwind CSS](https://tailwindcss.com/)
- **ルーティング:** [React Router](https://reactrouter.com/)
- **フォーム管理:** [React Hook Form](https://react-hook-form.com/)
- **スキーマ検証:** [Zod](https://zod.dev/)
- **通知 (Toast):** [Sonner](https://sonner.emilkowal.ski/)
- **APIクライアント:** `fetch` API (カスタムラッパー経由)

## 2. プロジェクト構造

プロジェクトの主要なファイルとディレクトリの構造は以下の通りです。

```
frontend/
├── public/              # 静的アセット
├── src/                 # ソースコード
│   ├── assets/          # 画像などのアセット
│   ├── components/      # 再利用可能なReactコンポーネント
│   ├── contexts/        # Reactコンテキスト
│   ├── hooks/           # カスタムReactフック
│   ├── lib/             # ヘルパー関数、APIクライアントなど
│   ├── types/           # TypeScriptの型定義 (現在は空)
│   ├── App.css          # Appコンポーネント用のスタイル
│   ├── App.jsx          # メインアプリケーションコンポーネント
│   ├── index.css        # グローバルスタイル
│   └── main.jsx         # アプリケーションのエントリーポイント
├── .eslintrc.js         # ESLint設定ファイル
├── index.html           # ViteのエントリーHTML
├── package.json         # プロジェクト情報と依存関係
├── vite.config.js       # Vite設定ファイル
└── tailwind.config.js   # Tailwind CSS設定ファイル
```

## 3. 主要なディレクトリとファイルの役割

### `src/`

アプリケーションのすべてのソースコードがこのディレクトリに含まれます。

#### `main.jsx`
アプリケーションの**エントリーポイント**です。
ReactアプリケーションをDOMにレンダリングする役割を担います。`App`コンポーネントをラップし、`#root`要素にマウントします。

#### `App.jsx`
アプリケーションの**ルートコンポーネント**です。
- UI全体のレイアウトを定義します。
- ほとんどのアプリケーションレベルの状態（スレッド情報、実行状態、UIの表示/非表示など）を`useState`フックで管理します。
- バックエンドAPIとの通信を開始するための主要なロジック（ファイルのアップロード、処理の実行など）を含んでいます。
- `useEffect`を使用して、コンポーネントのマウント時に初期データを取得します。
- `sonner`を利用した通知表示のトリガーとなります。

#### `components/`
再利用可能なReactコンポーネントを格納します。UIは機能的な関心事に基づいて小さなコンポーネントに分割されています。
- **`ui/`**: `shadcn/ui`から提供される、汎用的なUIコンポーネント（ボタン、ダイアログ、カードなど）。
- **`DataUpload.jsx`**: ファイルやフォルダのアップロードを担当するUIセクション。
- **`ProcedureExecution.jsx`**: 処理の実行や進捗表示を行うUIセクション。
- **`HITLMessage.jsx`**: 人的介入（Human-in-the-loop）が必要な場合に表示されるモーダルやメッセージ。
- **`ResultsView.jsx`**: 処理結果を表示するコンポーネント。
- **`HistoryList.jsx`**: 過去の実行履歴を表示するリスト。

#### `hooks/`
カスタムReactフックを格納します。これにより、コンポーネントロジックを再利用可能な関数に抽出します。
- **`useNotifications.js`**: `sonner`ライブラリをラップし、成功、エラー、情報などの通知を簡単に表示するためのカスタムフック。

#### `contexts/`
ReactのContext APIを使用するためのファイルを格納します。グローバルな状態をpropsのバケツリレーなしでコンポーネントツリーに渡すために使用されます。
- **`ThreadContext.jsx`**: 現在選択されているスレッドや関連する状態を管理し、アプリケーション全体で共有するためのコンテキスト。

#### `lib/`
特定のフレームワークに依存しない、ヘルパー関数やライブラリコードを格納します。
- **`api.js`**: バックエンドAPIとの通信ロジックをカプセル化しています。`fetch`をラップし、エンドポイントへのリクエスト、実行状態の監視（ポーリング）、エラーハンドリングなどを行います。
- **`utils.js`**: `tailwind-merge`と`clsx`を結合した`cn`関数など、汎用的なユーティリティ関数を提供します。

#### `assets/`
画像、フォント、SVGなどの静的アセットを格納します。

## 4. データフローと状態管理

1.  **起動**: `App.jsx`がマウントされ、`useEffect`がトリガーされて`api.js`経由で過去のスレッド一覧やサンプルフォルダ一覧をバックエンドから取得し、stateに保存します。
2.  **ユーザー操作**:
    - ユーザーがサンプルデータやテンプレートファイルをアップロードすると、対応するハンドラ関数が`api.js`のアップロード関数を呼び出します。
    - ユーザーが「実行」ボタンをクリックすると、`handleExecute`が呼び出され、新しいスレッドを作成し、処理を開始するAPIリクエストを送信します。
3.  **実行と監視**:
    - 処理が開始されると、`api.monitorExecution`が定期的にバックエンドに問い合わせ（ポーリング）、進捗状況を取得します。
    - 取得した進捗は`App.jsx`のstateを更新し、UI（プログレスバーなど）に反映されます。
4.  **人的介入 (HITL)**:
    - 監視中にバックエンドから`interrupt`が返されると、`HITLMessage`コンポーネントが表示されます。
    - ユーザーが応答すると、その内容がAPI経由でバックエンドに送信され、処理が再開されます。
5.  **完了**:
    - 処理が完了すると、結果がstateに保存され、`ResultsView`コンポーネントに表示されます。
    - 同時に完了通知が表示され、実行履歴が更新されます。

状態管理は主に`App.jsx`コンポーネント内の`useState`によって行われており、一部のグローバルな状態（スレッド情報）は`ThreadContext`を介して共有されます。 